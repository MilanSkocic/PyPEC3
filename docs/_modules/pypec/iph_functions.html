<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pypec.iph_functions &#8212; pypec 0.1.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css?v=514cf933" />
    
    <script src="../../_static/documentation_options.js?v=a58bc63e"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pypec 0.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pypec.iph_functions</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pypec.iph_functions</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot; Modules - Iph Functions</span>

<span class="sd">This module contains functions requiered for computing and optimizing the photo-current values from</span>
<span class="sd">input parameters i.e. triplets :math:`(K_i, \theta_i, Eg_i)` and experimental data for each semi-conductive phase :cite:p:`Petit2013`.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fmin</span> <span class="k">as</span> <span class="n">nelder_mead</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span><span class="p">,</span> <span class="n">t</span>
<span class="kn">from</span> <span class="nn">scipy.optimize.slsqp</span> <span class="kn">import</span> <span class="n">approx_jacobian</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_pdf</span> <span class="kn">import</span> <span class="n">PdfPages</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">AutoMinorLocator</span>

<span class="kn">from</span> <span class="nn">.plotstyle</span> <span class="kn">import</span> <span class="n">DATA_SAVE_STYLE</span><span class="p">,</span> <span class="n">FIT_SAVE_STYLE</span><span class="p">,</span> <span class="n">DISTANCE_VALID_STYLE</span><span class="p">,</span> <span class="n">DISTANCE_INVALID_STYLE</span><span class="p">,</span> <span class="n">DATA_SUMMARY_STYLE</span>

<span class="n">FIT_SETTING_EXT</span> <span class="o">=</span> <span class="s1">&#39;FitSet&#39;</span>
<span class="n">PRM_INIT_EXT</span> <span class="o">=</span> <span class="s1">&#39;PrmInit&#39;</span>
<span class="n">PRM_END_EXT</span> <span class="o">=</span> <span class="s1">&#39;PrmEnd&#39;</span>
<span class="n">PRM_MIN_EXT</span> <span class="o">=</span> <span class="s1">&#39;PrmMin&#39;</span>
<span class="n">DATA_MIN_EXT</span> <span class="o">=</span> <span class="s1">&#39;DataMin&#39;</span>
<span class="n">DATA_END_EXT</span> <span class="o">=</span> <span class="s1">&#39;DataEnd&#39;</span>
<span class="n">PRM_ALL_RUN_EXT</span> <span class="o">=</span> <span class="s1">&#39;PrmAll&#39;</span>
<span class="n">DATA_FILE_EXTS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dot&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">SUMMARY_END_EXT</span> <span class="o">=</span> <span class="s1">&#39;SumEnd&#39;</span>
<span class="n">SUMMARY_END_Eg_EXT</span> <span class="o">=</span> <span class="s1">&#39;SumEndEg&#39;</span>
<span class="n">SUMMARY_MIN_EXT</span> <span class="o">=</span> <span class="s1">&#39;SumMin&#39;</span>
<span class="n">SUMMARY_MIN_Eg_EXT</span> <span class="o">=</span> <span class="s1">&#39;SumMinEg&#39;</span>

<span class="c1"># _ARCHITECTURE, _OS = platform.architecture()</span>
<span class="c1"># _FLOAT = np.float32</span>
<span class="c1"># _FLOAT_COMPLEX = np.complex64</span>
<span class="c1"># if _ARCHITECTURE == &#39;64bit&#39;:</span>
<span class="c1">#    _FLOAT = np.float64</span>
<span class="c1">#    _FLOAT_COMPLEX = np.complex128</span>
<span class="n">_FLOAT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
<span class="n">_FLOAT_COMPLEX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span>
<span class="n">_EPSILON</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">_FLOAT</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;M.Skocic&#39;</span>


<div class="viewcode-block" id="get_header_footer_dot_file">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.get_header_footer_dot_file">[docs]</a>
<span class="k">def</span> <span class="nf">get_header_footer_dot_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Find the number of lines in header and footer in .dot files.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    filepath: path to the dot file</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    skip_header: int</span>
<span class="sd">        number of lines in header</span>
<span class="sd">    </span>
<span class="sd">    skip_footer: int</span>
<span class="sd">        number of lines in footer</span>
<span class="sd">    </span>
<span class="sd">    nbpoints: int</span>
<span class="sd">        number of data lines</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">n_0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">n_1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">n_0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_0</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">n_1</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">]:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">skip_header</span> <span class="o">=</span> <span class="n">n_0</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="n">skip_footer</span> <span class="o">=</span> <span class="n">k</span>
    <span class="n">nbpoints</span> <span class="o">=</span> <span class="n">n_1</span>
    <span class="k">return</span> <span class="n">skip_header</span><span class="p">,</span> <span class="n">skip_footer</span><span class="p">,</span> <span class="n">nbpoints</span></div>



<div class="viewcode-block" id="get_exp_data">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.get_exp_data">[docs]</a>
<span class="k">def</span> <span class="nf">get_exp_data</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Get the data array of data files according to their extension.</span>

<span class="sd">    Supported files are .dot files recorded by PECLab software and .data files</span>
<span class="sd">    were the first three columns represent :math:`h\nu`, :math:`\left | Iph^{\ast} \right |`, :math:`\theta`.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    filepath: string</span>
<span class="sd">        Path to the data file.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    data_array: 2d array</span>
<span class="sd">        Experimental data.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dot&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">]</span>
    <span class="n">flag_iphB</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span>
    <span class="n">skip_header</span><span class="p">,</span> <span class="n">skip_footer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">converters</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;dot&#39;</span><span class="p">:</span>
            <span class="n">skip_header</span><span class="p">,</span> <span class="n">skip_footer</span><span class="p">,</span> <span class="n">nbpoints</span> <span class="o">=</span> <span class="n">get_header_footer_dot_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
            <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span>
            <span class="n">converters</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
            <span class="n">skip_header</span><span class="p">,</span> <span class="n">skip_footer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
            <span class="n">converters</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;txt&#39;</span><span class="p">:</span>
            <span class="n">skip_header</span><span class="p">,</span> <span class="n">skip_footer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
            <span class="n">converters</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">hv</span><span class="p">,</span> <span class="n">Iph</span><span class="p">,</span> <span class="n">IphN</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">IphB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span>
                                                       <span class="n">dtype</span><span class="o">=</span><span class="n">_FLOAT</span><span class="p">,</span>
                                                       <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                                                       <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
                                                       <span class="n">skip_header</span><span class="o">=</span><span class="n">skip_header</span><span class="p">,</span>
                                                       <span class="n">skip_footer</span><span class="o">=</span><span class="n">skip_footer</span><span class="p">,</span>
                                                       <span class="n">converters</span><span class="o">=</span><span class="n">converters</span><span class="p">,</span>
                                                       <span class="n">missing_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                       <span class="n">filling_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                       <span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">,</span>
                                                       <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                       <span class="n">excludelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                       <span class="n">deletechars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                       <span class="n">replace_space</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span>
                                                       <span class="n">autostrip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                       <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                       <span class="n">defaultfmt</span><span class="o">=</span><span class="s1">&#39;f</span><span class="si">%i</span><span class="s1">&#39;</span><span class="p">,</span>
                                                       <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                       <span class="n">usemask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                       <span class="n">loose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                       <span class="n">invalid_raise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">flag_iphB</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">hv</span><span class="p">,</span> <span class="n">Iph</span><span class="p">,</span> <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span>
                                           <span class="n">dtype</span><span class="o">=</span><span class="n">_FLOAT</span><span class="p">,</span>
                                           <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                                           <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
                                           <span class="n">skip_header</span><span class="o">=</span><span class="n">skip_header</span><span class="p">,</span>
                                           <span class="n">skip_footer</span><span class="o">=</span><span class="n">skip_footer</span><span class="p">,</span>
                                           <span class="n">converters</span><span class="o">=</span><span class="n">converters</span><span class="p">,</span>
                                           <span class="n">missing_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">filling_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">,</span>
                                           <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">excludelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">deletechars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">replace_space</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span>
                                           <span class="n">autostrip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                           <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">defaultfmt</span><span class="o">=</span><span class="s1">&#39;f</span><span class="si">%i</span><span class="s1">&#39;</span><span class="p">,</span>
                                           <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">usemask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                           <span class="n">loose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                           <span class="n">invalid_raise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">IphB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">hv</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_FLOAT</span><span class="p">)</span>
            <span class="n">IphB</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">Iph</span><span class="p">[:]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">Iph</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">IphN</span> <span class="o">=</span> <span class="n">Iph</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Iph</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">hv</span><span class="p">,</span> <span class="n">Iph</span><span class="p">,</span> <span class="n">IphN</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">IphB</span><span class="p">,</span> <span class="n">flag_iphB</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;FileType Error: File was not recognized&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="import_prm_file">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.import_prm_file">[docs]</a>
<span class="k">def</span> <span class="nf">import_prm_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Import the triplets :math:`(K_i, \theta_i, Eg_i)` from text file where each line represents a</span>
<span class="sd">    contributing semi-conductive phase.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    filepath: string</span>
<span class="sd">        Absolute or relative file path to the text file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    prm_array: 2d array</span>
<span class="sd">        Represents the values and states of the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="c1"># Import all lines from the text file</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">prm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">path</span><span class="p">,</span>
                         <span class="n">dtype</span><span class="o">=</span><span class="n">_FLOAT</span><span class="p">,</span>
                         <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                         <span class="n">converters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                         <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                         <span class="n">unpack</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="n">prm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">path</span><span class="p">,</span>
                         <span class="n">dtype</span><span class="o">=</span><span class="n">_FLOAT</span><span class="p">,</span>
                         <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                         <span class="n">converters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">ndmin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                         <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
                         <span class="n">unpack</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Check if zeros lines are zeros lines</span>
    <span class="c1"># Zeros lines are ignored</span>
    <span class="n">sum_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mask</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sum_array</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">nb_SC</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">size</span>

    <span class="n">prm_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nb_SC</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span>
    <span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Initialize to -1 the errors</span>

    <span class="c1"># compatibility layer for parameter files that do not have</span>
    <span class="c1"># the 3 extra columns for the parameter errors</span>
    <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">prm</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
        <span class="n">prm_array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">prm</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">prm</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">return</span> <span class="n">prm_array</span></div>



<div class="viewcode-block" id="get_random_prm_values">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.get_random_prm_values">[docs]</a>
<span class="k">def</span> <span class="nf">get_random_prm_values</span><span class="p">(</span><span class="n">prm_array</span><span class="p">,</span>
                          <span class="n">K_bound</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">theta_bound</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">),</span>
                          <span class="n">Eg_bound</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">6.2</span><span class="p">),</span>
                          <span class="n">phase_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Generates random values for the triplets :math:`(K_i, \theta_i, Eg_i)` to be fitted based on the states</span>
<span class="sd">    given by the `prm_array`.</span>

<span class="sd">    By default, the limits are:</span>
<span class="sd">    </span>
<span class="sd">    * :math:`K_i`: :math:`[10^{-12},10^{-1}]`</span>
<span class="sd">    * :math:`\theta _i`: :math:`[-\pi,+\pi]`</span>
<span class="sd">    * :math:`Eg_i`: :math:`[0.1, 6.0]`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prm_array: 2d array</span>
<span class="sd">        Represents the values and states of the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>
<span class="sd">        </span>
<span class="sd">    K_bound:tuple</span>
<span class="sd">        Contains the lower and upper limits for the :math:`K_i` values.</span>

<span class="sd">    theta_bound: tuple</span>
<span class="sd">        Contains the lower and upper limits for the :math:`\theta _i` values.</span>

<span class="sd">    Eg_bound:tuple</span>
<span class="sd">        Contains the lower and upper limits for the :math:`Eg_i` values.</span>

<span class="sd">    phase_flag: bool</span>
<span class="sd">        Indicates if the values of :math:`\theta _i` have to be randomized.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    random_prm_array: 2d array</span>
<span class="sd">        Represents the values and states of the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">K_low</span><span class="p">,</span> <span class="n">K_up</span> <span class="o">=</span> <span class="n">K_bound</span>
    <span class="n">log_K_low</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">K_low</span><span class="p">)</span>
    <span class="n">log_K_up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">K_up</span><span class="p">)</span>
    <span class="n">theta_low</span><span class="p">,</span> <span class="n">theta_up</span> <span class="o">=</span> <span class="n">theta_bound</span>
    <span class="n">Eg_low</span><span class="p">,</span> <span class="n">Eg_up</span> <span class="o">=</span> <span class="n">Eg_bound</span>

    <span class="n">random_prm_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">prm_array</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_FLOAT</span><span class="p">)</span>
    <span class="n">random_prm_array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">prm_array</span><span class="p">[:]</span>

    <span class="k">if</span> <span class="n">phase_flag</span><span class="p">:</span>
        <span class="n">mask</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">random_prm_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">random_prm_array</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">log_K_low</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">log_K_up</span> <span class="o">-</span> <span class="n">log_K_low</span><span class="p">))</span>

        <span class="n">mask</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">random_prm_array</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">random_prm_array</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_low</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta_up</span> <span class="o">-</span> <span class="n">theta_low</span><span class="p">)</span>

        <span class="n">mask</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">random_prm_array</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">random_prm_array</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">Eg_low</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eg_up</span> <span class="o">-</span> <span class="n">Eg_low</span><span class="p">)</span>

    <span class="k">elif</span> <span class="ow">not</span> <span class="n">phase_flag</span><span class="p">:</span>
        <span class="n">mask</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">random_prm_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">random_prm_array</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">log_K_low</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">log_K_up</span> <span class="o">-</span> <span class="n">log_K_low</span><span class="p">))</span>

        <span class="n">mask</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">random_prm_array</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">random_prm_array</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">Eg_low</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eg_up</span> <span class="o">-</span> <span class="n">Eg_low</span><span class="p">)</span>

    <span class="n">random_prm_array</span> <span class="o">=</span> <span class="n">sort_prm_Eg</span><span class="p">(</span><span class="n">random_prm_array</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">random_prm_array</span></div>



<div class="viewcode-block" id="sort_prm_Eg">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.sort_prm_Eg">[docs]</a>
<span class="k">def</span> <span class="nf">sort_prm_Eg</span><span class="p">(</span><span class="n">prm_array</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Sort the ``prm_array`` based on values of :math:`Eg_i`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    prm_array: 2d array</span>
<span class="sd">        Represents the values and states of the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    prm_array: 2d array</span>
<span class="sd">        Represents the sorted values and states of the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">])</span>
    <span class="n">prm_array</span> <span class="o">=</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">prm_array</span></div>



<div class="viewcode-block" id="shift_phase">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.shift_phase">[docs]</a>
<span class="k">def</span> <span class="nf">shift_phase</span><span class="p">(</span><span class="n">prm_array</span><span class="p">,</span> <span class="n">theta_bound</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">)):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Compute the modulo of :math:`\theta _i` values with :math:`2\pi` and then</span>
<span class="sd">    shift the values of :math:`\theta _i` by the amplitude of the boundaries in order</span>
<span class="sd">    to be in between the boundaries.</span>

<span class="sd">    By default, the boundaries for :math:`\theta _i` are set to :math:`[-\pi,+\pi]`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prm_array: 2d array</span>
<span class="sd">        Represents the values and states of the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>

<span class="sd">    theta_bound: tuple</span>
<span class="sd">        Contains the lower and upper limits for the :math`theta _i` values.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    prm_array: 2d array</span>
<span class="sd">        Represents the values and states of the triplets :math:`(K_i, \theta_i, Eg_i)` where the</span>
<span class="sd">        :math:`\theta _i` values were shifted.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">theta_low</span><span class="p">,</span> <span class="n">theta_up</span> <span class="o">=</span> <span class="n">theta_bound</span>

    <span class="n">mask</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">theta_up</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">theta_low</span><span class="p">))</span>
    <span class="n">prm_array</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">360</span><span class="p">)</span>

    <span class="n">mask</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">theta_up</span><span class="p">)</span>
    <span class="n">prm_array</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">theta_up</span> <span class="o">-</span> <span class="n">theta_low</span><span class="p">)</span>

    <span class="n">mask</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">theta_low</span><span class="p">)</span>
    <span class="n">prm_array</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">theta_up</span> <span class="o">-</span> <span class="n">theta_low</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">prm_array</span></div>



<div class="viewcode-block" id="validate_prm">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.validate_prm">[docs]</a>
<span class="k">def</span> <span class="nf">validate_prm</span><span class="p">(</span><span class="n">prm_array</span><span class="p">,</span>
                 <span class="n">K_bound</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                 <span class="n">Eg_bound</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">6.2</span><span class="p">)):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Check if the values of :math:`K_i` and :math:`Eg_i` are within the boundaries.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prm_array: 2d array</span>
<span class="sd">        Represents the values and states of the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>

<span class="sd">    K_bound:tuple</span>
<span class="sd">        Contains the lower and upper limits for the :math:`K_i` values.</span>

<span class="sd">    Eg_bound:tuple</span>
<span class="sd">        Contains the lower and upper limits for the :math:`Eg_i` values.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    valid: bool</span>
<span class="sd">        Set to True if value of :math:`K_i` or :math:`Eg_i` is out of the boundaries.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">K_low</span><span class="p">,</span> <span class="n">K_up</span> <span class="o">=</span> <span class="n">K_bound</span>
    <span class="n">Eg_low</span><span class="p">,</span> <span class="n">Eg_up</span> <span class="o">=</span> <span class="n">Eg_bound</span>

    <span class="n">mask_K</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">K_up</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">K_low</span><span class="p">))</span>
    <span class="n">mask_Eg</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">Eg_up</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">Eg_low</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_K</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_Eg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">valid</span></div>



<div class="viewcode-block" id="get_distance">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.get_distance">[docs]</a>
<span class="k">def</span> <span class="nf">get_distance</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">iph_calc_complex</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Compute the distance :math:`D` between :math:`Iph_{exp}` and</span>
<span class="sd">    :math:`Iph_{calc}`.</span>
<span class="sd">    The distance is computed by multiplying the distances on real and imaginary</span>
<span class="sd">    parts of :math:`Iph`:</span>

<span class="sd">    .. math::</span>
<span class="sd">        </span>
<span class="sd">        \Delta Re &amp; = Re \, Iph_{exp} - Re \, Iph_{calc} \\</span>
<span class="sd">        \Delta Im &amp; = Im \, Iph_{exp} - Im \, Iph_{calc} \\</span>
<span class="sd">        D_{Re} &amp; = \sqrt{\sum{\Delta Re ^2}}\\</span>
<span class="sd">        D_{Im} &amp; = \sqrt{\sum{\Delta Im ^2}}\\</span>
<span class="sd">        D &amp; = D_{Re} \cdot D_{Im}</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    iph_exp_complex: 1d numpy array</span>
<span class="sd">            Contains the complex values of the :math:`Iph_{exp}`.</span>

<span class="sd">    iph_calc_complex: 1d numpy array</span>
<span class="sd">            Contains the complex values of the :math:`Iph_{calc}`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    D: float</span>
<span class="sd">            The computed distance on real and imaginary parts of :math:`Iph`:.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Re_iph_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">)</span>
    <span class="n">Im_iph_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">)</span>

    <span class="n">Re_iph_calc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">)</span>
    <span class="n">Im_iph_calc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">)</span>

    <span class="n">delta_Re</span> <span class="o">=</span> <span class="p">(</span><span class="n">Re_iph_exp</span> <span class="o">-</span> <span class="n">Re_iph_calc</span><span class="p">)</span>
    <span class="n">delta_Im</span> <span class="o">=</span> <span class="p">(</span><span class="n">Im_iph_exp</span> <span class="o">-</span> <span class="n">Im_iph_calc</span><span class="p">)</span>

    <span class="n">D_Re</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">delta_Re</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">D_Im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">delta_Im</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">D_Re</span> <span class="o">*</span> <span class="n">D_Im</span>

    <span class="k">return</span> <span class="n">D</span></div>



<span class="k">def</span> <span class="nf">_get_residuals</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">hv</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;DocString&quot;&quot;&quot;</span>

    <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">prm_array</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">((</span><span class="n">get_Iph_calc</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">)</span> <span class="o">-</span> <span class="n">iph_exp_complex</span><span class="p">)</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_chi2</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">hv</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;DocString&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">_get_residuals</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">hv</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>


<div class="viewcode-block" id="get_Iph_calc">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.get_Iph_calc">[docs]</a>
<span class="k">def</span> <span class="nf">get_Iph_calc</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the complex values of :math:`Iph` based on the values </span>
<span class="sd">    and states of the triplets :math:`(K_i, \theta_i, Eg_i)` :cite:p:`Petit2013`.</span>

<span class="sd">    .. math::</span>
<span class="sd">        Iph^{\ast} = \frac{Iph}{\Phi_{N}}</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hv: 1d array</span>
<span class="sd">        Vector of energies for which the complex :math:`Iph` has to be computed.</span>

<span class="sd">    prm_array: 2d array</span>
<span class="sd">        Represents the values and states of the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>

<span class="sd">    phi_N: 1d array</span>
<span class="sd">        Represents the values of the normalized photon flux to the maximum value.</span>
<span class="sd">        If nphf is a unity vector, the true photo-current is returned otherwise the </span>
<span class="sd">        as-measured photo-current is returned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    iph_calc_complex: 1d array</span>
<span class="sd">        Vector of the computed complex values of :math:`Iph`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nb_SC</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">prm_array</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">iph_calc_complex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">hv</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_SC</span><span class="p">):</span>
        <span class="n">d_hv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">hv</span> <span class="o">&gt;</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">(</span><span class="n">hv</span> <span class="o">-</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">iph_calc_complex</span><span class="p">[:]</span> <span class="o">+=</span> <span class="p">((</span><span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_hv</span><span class="p">)</span> <span class="o">**</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">hv</span> <span class="o">**</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>

    <span class="n">iph_calc_complex</span> <span class="o">*=</span> <span class="n">phi_N</span>

    <span class="k">return</span> <span class="n">iph_calc_complex</span></div>



<span class="k">def</span> <span class="nf">_jacobian</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">):</span>
    <span class="n">nb_SC</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">prm_array</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">Dfun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">hv</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="c1"># iph_i = np.zeros(shape=hv.shape, dtype=np.complex128)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_SC</span><span class="p">):</span>
        <span class="n">d_hv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">hv</span> <span class="o">&gt;</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">(</span><span class="n">hv</span> <span class="o">-</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">iph_i</span> <span class="o">=</span> <span class="p">((</span><span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">d_hv</span><span class="p">)</span> <span class="o">**</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">hv</span> <span class="o">**</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>

        <span class="n">Dfun</span><span class="p">[:,</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">iph_i</span> <span class="o">/</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">Dfun</span><span class="p">[:,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">iph_i</span>
        <span class="n">Dfun</span><span class="p">[:,</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">d_hv</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">iph_i</span> <span class="o">/</span> <span class="n">d_hv</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">Dfun</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_random_scan</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span>
                 <span class="n">prm_array</span><span class="p">,</span>
                 <span class="n">iph_exp_complex</span><span class="p">,</span>
                 <span class="n">phi_N</span><span class="p">,</span>
                 <span class="n">weights</span><span class="p">,</span>
                 <span class="n">loops</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">K_bound</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                 <span class="n">theta_bound</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">),</span>
                 <span class="n">Eg_bound</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">6.2</span><span class="p">),</span>
                 <span class="n">phase_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Performs a random scan of the values of the triplets :math:`(K_i, \theta_i, Eg_i)`. The number of random loops is</span>
<span class="sd">    set with the parameter `loops`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hv: 1d array</span>
<span class="sd">        Vector of energies for which the complex :math:`Iph` has to be computed.</span>

<span class="sd">    prm_array: 2d array</span>
<span class="sd">        Represents the values and states of the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>

<span class="sd">    iph_exp_complex: 1d numpy array</span>
<span class="sd">        Contains the complex values of the experimental :math:`Iph`.</span>

<span class="sd">    phi_N: 1d array</span>
<span class="sd">        Represents the values of the normalized photon flux to the maximum value.</span>
<span class="sd">    </span>
<span class="sd">    loops: int</span>
<span class="sd">        Number of loops for random scan.</span>

<span class="sd">    K_bound:tuple</span>
<span class="sd">        Contains the lower and upper limits for the :math:`K_i` values.</span>

<span class="sd">    theta_bound: tuple</span>
<span class="sd">        Contains the lower and upper limits for the :math:`\theta _i` values.</span>

<span class="sd">    Eg_bound:tuple</span>
<span class="sd">        Contains the lower and upper limits for the :math:`Eg_i` values.</span>

<span class="sd">    phase_flag: bool</span>
<span class="sd">        Indicates if the values of :math:`\theta _i` have to be randomized.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    prm_array_random_min: 2d array</span>
<span class="sd">        Represents the best values and states of the triplets :math:`(K_i, \theta_i, Eg_i)` after random scan.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prm_array_random_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">prm_array</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_FLOAT</span><span class="p">)</span>

    <span class="c1"># 1st random scan</span>
    <span class="n">prm_array_random</span> <span class="o">=</span> <span class="n">get_random_prm_values</span><span class="p">(</span><span class="n">prm_array</span><span class="p">,</span>
                                             <span class="n">K_bound</span><span class="o">=</span><span class="n">K_bound</span><span class="p">,</span>
                                             <span class="n">theta_bound</span><span class="o">=</span><span class="n">theta_bound</span><span class="p">,</span>
                                             <span class="n">Eg_bound</span><span class="o">=</span><span class="n">Eg_bound</span><span class="p">,</span>
                                             <span class="n">phase_flag</span><span class="o">=</span><span class="n">phase_flag</span><span class="p">)</span>
    <span class="n">prm_array_random</span> <span class="o">=</span> <span class="n">sort_prm_Eg</span><span class="p">(</span><span class="n">prm_array_random</span><span class="p">)</span>
    <span class="c1"># iph_calc_complex = get_Iph_calc(hv, prm_array_random, phi_N)</span>

    <span class="n">prm_array_random_min</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">prm_array_random</span><span class="p">[:]</span>
    <span class="c1"># distance = get_distance(iph_exp_complex, iph_calc_complex)</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">_get_chi2</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">hv</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>

    <span class="n">distance_min</span> <span class="o">=</span> <span class="n">distance</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">loops</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">prm_array_random</span> <span class="o">=</span> <span class="n">get_random_prm_values</span><span class="p">(</span><span class="n">prm_array_random</span><span class="p">,</span>
                                                 <span class="n">K_bound</span><span class="o">=</span><span class="n">K_bound</span><span class="p">,</span>
                                                 <span class="n">theta_bound</span><span class="o">=</span><span class="n">theta_bound</span><span class="p">,</span>
                                                 <span class="n">Eg_bound</span><span class="o">=</span><span class="n">Eg_bound</span><span class="p">,</span>
                                                 <span class="n">phase_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">prm_array_random</span> <span class="o">=</span> <span class="n">sort_prm_Eg</span><span class="p">(</span><span class="n">prm_array_random</span><span class="p">)</span>
        <span class="c1"># iph_calc_complex = get_Iph_calc(hv, prm_array_random, phi_N)</span>
        <span class="c1"># distance = get_distance(iph_exp_complex, iph_calc_complex)</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">_get_chi2</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">hv</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="n">validate_prm</span><span class="p">(</span><span class="n">prm_array_random</span><span class="p">,</span> <span class="n">K_bound</span><span class="o">=</span><span class="n">K_bound</span><span class="p">,</span> <span class="n">Eg_bound</span><span class="o">=</span><span class="n">Eg_bound</span><span class="p">)</span>
        <span class="n">prm_array_random</span> <span class="o">=</span> <span class="n">shift_phase</span><span class="p">(</span><span class="n">prm_array_random</span><span class="p">,</span> <span class="n">theta_bound</span><span class="o">=</span><span class="n">theta_bound</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">distance_min</span><span class="p">:</span>
                <span class="n">distance_min</span> <span class="o">=</span> <span class="n">distance</span>
                <span class="n">prm_array_random_min</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">prm_array_random</span><span class="p">[:]</span>

    <span class="k">return</span> <span class="n">prm_array_random_min</span>


<div class="viewcode-block" id="target_func">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.target_func">[docs]</a>
<span class="k">def</span> <span class="nf">target_func</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">hv</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">Ki_log_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Update the triplets :math:`(K_i, \theta_i, Eg_i)` from the flattened parameter</span>
<span class="sd">    vector ``p`` sent by the optimization algorithm. The ``prm_array`` will be flattened</span>
<span class="sd">    and the indexes of the parameters to be fitted will be updated with ``p`` vector.</span>

<span class="sd">    The calculated complex values of :math:`Iph` will be sent along the</span>
<span class="sd">    experimental values to the :func:`get_distance` function. The value of the</span>
<span class="sd">    distance between the experimental and calculated data will sent back to the</span>
<span class="sd">    optimization algorithm.</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p: 1d array</span>
<span class="sd">        Parameter vector sent by the optimization algorithm which is always.</span>
<span class="sd">        flattened.</span>

<span class="sd">    hv: 1d array</span>
<span class="sd">        Vector of energies for which the complex values of :math:`Iph` have to be calculated.</span>

<span class="sd">    prm_array: 2d array</span>
<span class="sd">        Represents the values and states of the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>

<span class="sd">    iph_exp_complex: 1d numpy array</span>
<span class="sd">        Contains the complex values of the experimental :math:`Iph`.</span>

<span class="sd">    phi_N: 1d array</span>
<span class="sd">        Represents the values of the normalized photon flux to the maximum value.</span>

<span class="sd">    weights: 1d array</span>
<span class="sd">        Contains the values of the data weights.</span>

<span class="sd">    Ki_log_flag: bool</span>
<span class="sd">        Indicates if the :math:`K_i` values are in logarithmic space. </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    distance: float</span>
<span class="sd">        Calculated distance between experimental and calculated data values.</span>
<span class="sd">        See the :func:`get_distance` function.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">prm_array</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">prm_values_flatten</span> <span class="o">=</span> <span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">prm_states_flatten</span> <span class="o">=</span> <span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">prm_to_fit_mask</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prm_states_flatten</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="n">prm_values_flatten</span><span class="p">[</span><span class="n">prm_to_fit_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
    <span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">prm_values_flatten</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">mask_K_to_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Ki_log_flag</span><span class="p">:</span>
        <span class="n">prm_array</span><span class="p">[</span><span class="n">mask_K_to_fit</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">mask_K_to_fit</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="c1"># iph_calc_complex = get_Iph_calc(hv, prm_array, phi_N)</span>

    <span class="c1"># return get_distance(iph_exp_complex, iph_calc_complex)</span>
    <span class="k">return</span> <span class="n">_get_chi2</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">hv</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span></div>



<div class="viewcode-block" id="minimize">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.minimize">[docs]</a>
<span class="k">def</span> <span class="nf">minimize</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">,</span>
             <span class="n">Ki_log_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">maxiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxfun</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mf">1e-23</span><span class="p">,</span>
             <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retall</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Execute the Nelder-Mead algorithm based on parameter values given by</span>
<span class="sd">    ``prm_array`` and energy vector :math:`h\nu`.</span>

<span class="sd">    First, the ``prm_array`` is flattened and the parameters :math:`(K_i, \theta_i,</span>
<span class="sd">    Eg_i)` to be fitted are extracted and sent to the :func:`target_function`</span>
<span class="sd">    through the Nelder-Mead algorithm.</span>

<span class="sd">    Once the parameters were computed by the Nelder-Mead algorithm, ``the prm_array`` is updated</span>
<span class="sd">    with the new values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hv: 1d numpy array</span>
<span class="sd">        Contains the energy vector.</span>

<span class="sd">    iph_exp_complex: 1d numpy array</span>
<span class="sd">            Contains the complex values of the experimental photo-current.</span>

<span class="sd">    phi_N: 1d array</span>
<span class="sd">        Contains the normalized photon spectrum.</span>

<span class="sd">    weights: 1d array</span>
<span class="sd">        Contains the weights of the data.</span>

<span class="sd">    prm_array: 2d array</span>
<span class="sd">        Represents the values and states of the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>

<span class="sd">    Ki_log_flag: bool</span>
<span class="sd">        Indicates if the :math:`K_i` values are in logarithmic space.</span>

<span class="sd">    maxiter : int, optional</span>
<span class="sd">        Maximum number of iterations to perform.</span>

<span class="sd">    maxfun : number, optional</span>
<span class="sd">        Maximum number of function evaluations to make.</span>

<span class="sd">    xtol : float, optional</span>
<span class="sd">        Relative error in xopt acceptable for convergence.</span>

<span class="sd">    ftol : number, optional</span>
<span class="sd">        Relative error in func(xopt) acceptable for convergence.</span>

<span class="sd">    full_output : bool, optional</span>
<span class="sd">        Set to True if fopt and warnflag outputs are desired.</span>

<span class="sd">    retall : bool, optional</span>
<span class="sd">        Set to True to return list of solutions at each iteration.</span>

<span class="sd">    disp : bool, optional</span>
<span class="sd">        Set to True to print convergence messages.</span>

<span class="sd">    callback : callable, optional</span>
<span class="sd">        Called after each iteration, as callback(xk), where xk is the</span>
<span class="sd">        current parameter vector.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    prm_array: 2d array</span>
<span class="sd">        Represents the updated values and states of the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>

<span class="sd">    fopt : float</span>
<span class="sd">        Value of function at minimum: ``fopt = func(xopt)``.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask_K_to_fit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Ki_log_flag</span><span class="p">:</span>
        <span class="n">prm_array</span><span class="p">[</span><span class="n">mask_K_to_fit</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[</span><span class="n">mask_K_to_fit</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="n">prm_values_flatten</span> <span class="o">=</span> <span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">prm_states_flatten</span> <span class="o">=</span> <span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">prm_to_fit_mask</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prm_states_flatten</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">prm_values_flatten</span><span class="p">[</span><span class="n">prm_to_fit_mask</span><span class="p">]</span>

    <span class="n">popt</span><span class="p">,</span> <span class="n">fopt</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">funcalls</span><span class="p">,</span> <span class="n">warnflag</span> <span class="o">=</span> <span class="n">nelder_mead</span><span class="p">(</span><span class="n">target_func</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span>
                                                            <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span>
                                                                  <span class="n">Ki_log_flag</span><span class="p">),</span>
                                                            <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span>
                                                            <span class="n">maxfun</span><span class="o">=</span><span class="n">maxfun</span><span class="p">,</span>
                                                            <span class="n">xtol</span><span class="o">=</span><span class="n">xtol</span><span class="p">,</span>
                                                            <span class="n">ftol</span><span class="o">=</span><span class="n">ftol</span><span class="p">,</span>
                                                            <span class="n">full_output</span><span class="o">=</span><span class="n">full_output</span><span class="p">,</span>
                                                            <span class="n">retall</span><span class="o">=</span><span class="n">retall</span><span class="p">,</span>
                                                            <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                                                            <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>

    <span class="n">prm_values_flatten</span><span class="p">[</span><span class="n">prm_to_fit_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">popt</span>
    <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">prm_array</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">prm_values_flatten</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">Ki_log_flag</span><span class="p">:</span>
        <span class="n">prm_array</span><span class="p">[</span><span class="n">mask_K_to_fit</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">prm_array</span><span class="p">[</span><span class="n">mask_K_to_fit</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">prm_array</span> <span class="o">=</span> <span class="n">sort_prm_Eg</span><span class="p">(</span><span class="n">prm_array</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">prm_array</span><span class="p">,</span> <span class="n">fopt</span></div>



<span class="k">def</span> <span class="nf">_callback_fit</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">nb_run</span><span class="p">,</span> <span class="n">fit</span><span class="p">,</span> <span class="n">nb_minimization</span><span class="p">,</span>
                  <span class="n">distance</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span>
                  <span class="n">LCC_results</span><span class="p">,</span> <span class="n">prm_array</span><span class="p">,</span> <span class="n">additional_messages</span><span class="o">=</span><span class="p">()):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;cls&#39;</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;nt&#39;</span> <span class="k">else</span> <span class="s1">&#39;clear&#39;</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;***** Run = </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1"> ***** </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">run</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nb_run</span><span class="p">))</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Minimizing ...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="s1">&#39;Fit </span><span class="si">{0:03d}</span><span class="s1">/</span><span class="si">{4:03d}</span><span class="s1">-log10(D)=</span><span class="si">{1:+09.4f}</span><span class="s1">-Valid=</span><span class="si">{2:b}</span><span class="s1">-LCC=</span><span class="si">{5:.6f}</span><span class="s1">,</span><span class="si">{6:.6f}</span><span class="s1">,</span><span class="si">{7:.6f}</span><span class="s1">,</span><span class="si">{8:.6f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                                                                                           <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
                                                                                                               <span class="n">distance</span><span class="p">),</span>
                                                                                                           <span class="n">valid</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span>
                                                                                                           <span class="n">nb_minimization</span><span class="p">,</span>
                                                                                                           <span class="n">LCC_results</span><span class="p">[</span>
                                                                                                               <span class="mi">0</span><span class="p">],</span>
                                                                                                           <span class="n">LCC_results</span><span class="p">[</span>
                                                                                                               <span class="mi">1</span><span class="p">],</span>
                                                                                                           <span class="n">LCC_results</span><span class="p">[</span>
                                                                                                               <span class="mi">2</span><span class="p">],</span>
                                                                                                           <span class="n">LCC_results</span><span class="p">[</span>
                                                                                                               <span class="mi">3</span><span class="p">]))</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">prm_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">additional_messages</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_round_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;DocString&quot;&quot;&quot;</span>
    <span class="n">log_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
    <span class="n">log_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">log_errors</span><span class="p">)</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">errors</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">log_errors</span><span class="p">))</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">log_errors</span>

    <span class="k">return</span> <span class="n">errors</span>


<span class="k">def</span> <span class="nf">_get_prm_error</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
    <span class="n">nb_param</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">nb_param</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">tvp</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">isf</span><span class="p">(</span><span class="mf">0.05</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">dof</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">jac</span> <span class="o">=</span> <span class="n">approx_jacobian</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">jac</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">jac</span><span class="p">))</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">_get_chi2</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">/</span> <span class="n">dof</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="n">_round_errors</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cov</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span> <span class="o">*</span> <span class="n">tvp</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid Matrix&#39;</span><span class="p">)</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_FLOAT</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">return</span> <span class="n">dp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>


<div class="viewcode-block" id="get_LCC">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.get_LCC">[docs]</a>
<span class="k">def</span> <span class="nf">get_LCC</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">iph_calc_complex</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mod_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">)</span>
    <span class="n">phase_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">Re_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">)</span>
    <span class="n">Im_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">)</span>

    <span class="n">mod_calc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">)</span>
    <span class="n">phase_calc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">Re_calc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">)</span>
    <span class="n">Im_calc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">)</span>

    <span class="n">slope_mod</span><span class="p">,</span> <span class="n">intercept_mod</span><span class="p">,</span> <span class="n">r_mod</span><span class="p">,</span> <span class="n">p_mod</span><span class="p">,</span> <span class="n">std_mod</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">mod_exp</span><span class="p">,</span> <span class="n">mod_calc</span><span class="p">)</span>
    <span class="n">slope_phase</span><span class="p">,</span> <span class="n">intercept_phase</span><span class="p">,</span> <span class="n">r_phase</span><span class="p">,</span> <span class="n">p_phase</span><span class="p">,</span> <span class="n">std_phase</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">phase_exp</span><span class="p">,</span> <span class="n">phase_calc</span><span class="p">)</span>
    <span class="n">slope_Re</span><span class="p">,</span> <span class="n">intercept_Re</span><span class="p">,</span> <span class="n">r_Re</span><span class="p">,</span> <span class="n">p_Re</span><span class="p">,</span> <span class="n">std_Re</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">Re_exp</span><span class="p">,</span> <span class="n">Re_calc</span><span class="p">)</span>
    <span class="n">slope_Im</span><span class="p">,</span> <span class="n">intercept_Im</span><span class="p">,</span> <span class="n">r_Im</span><span class="p">,</span> <span class="n">p_Im</span><span class="p">,</span> <span class="n">std_Im</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">Im_exp</span><span class="p">,</span> <span class="n">Im_calc</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">r_mod</span><span class="p">,</span> <span class="n">r_phase</span><span class="p">,</span> <span class="n">r_Re</span><span class="p">,</span> <span class="n">r_Im</span><span class="p">,</span>
            <span class="n">slope_mod</span><span class="p">,</span> <span class="n">slope_phase</span><span class="p">,</span> <span class="n">slope_Re</span><span class="p">,</span> <span class="n">slope_Im</span><span class="p">,</span>
            <span class="n">intercept_mod</span><span class="p">,</span> <span class="n">intercept_phase</span><span class="p">,</span> <span class="n">intercept_Re</span><span class="p">,</span> <span class="n">intercept_Im</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_results_array">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.get_results_array">[docs]</a>
<span class="k">def</span> <span class="nf">get_results_array</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">iph_calc_complex</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Build the data array of the experimental and calculated data: :math:`h\nu`,</span>
<span class="sd">    :math:`\left| Iph_{exp} \right|`, :math:`\theta _{exp}`, :math:`\left| Iph_{calc} \right|` and :math:`\theta _{calc}`</span>

<span class="sd">            </span>

<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    hv: 1d numpy array</span>
<span class="sd">        Contains the energy vector.</span>

<span class="sd">    iph_exp_complex: 1d array</span>
<span class="sd">            Contains the complex values of :math:`Iph_{exp}`.</span>

<span class="sd">    iph_calc_complex: 1d array</span>
<span class="sd">            Contains the complex values of :math:`Iph_{calc}`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data_array: 2d array</span>
<span class="sd">            Array containing the .</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">r</span><span class="s1">&#39;hv /eV&#39;</span><span class="p">,</span>
                        <span class="sa">r</span><span class="s1">&#39;|Iph_exp| /A&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Phase_exp /deg&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Re Iph_exp /A&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Im Iph_exp /A&#39;</span><span class="p">,</span>
                        <span class="sa">r</span><span class="s1">&#39;|Iph_calc| /A&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Phase_calc /deg&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Re Iph_calc /A&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Im Iph_calc /A&#39;</span><span class="p">,</span>
                        <span class="sa">r</span><span class="s1">&#39;Res |Iph| /A&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Res Phase /deg&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Res Re Iph /A&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;Res Im Iph /A&#39;</span><span class="p">])</span>

    <span class="n">mod_iph_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">)</span>
    <span class="n">phase_iph_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">Re_iph_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">)</span>
    <span class="n">Im_iph_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">)</span>

    <span class="n">mod_iph_calc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">)</span>
    <span class="n">phase_iph_calc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">Re_iph_calc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">)</span>
    <span class="n">Im_iph_calc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">)</span>

    <span class="n">Res_mod</span> <span class="o">=</span> <span class="n">mod_iph_exp</span> <span class="o">-</span> <span class="n">mod_iph_calc</span>
    <span class="n">Res_phase</span> <span class="o">=</span> <span class="n">phase_iph_exp</span> <span class="o">-</span> <span class="n">phase_iph_calc</span>
    <span class="n">Res_Re</span> <span class="o">=</span> <span class="n">Re_iph_exp</span> <span class="o">-</span> <span class="n">Re_iph_calc</span>
    <span class="n">Res_Im</span> <span class="o">=</span> <span class="n">Im_iph_exp</span> <span class="o">-</span> <span class="n">Im_iph_calc</span>

    <span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">hv</span><span class="p">,</span>
                                         <span class="n">mod_iph_exp</span><span class="p">,</span>
                                         <span class="n">phase_iph_exp</span><span class="p">,</span>
                                         <span class="n">Re_iph_exp</span><span class="p">,</span>
                                         <span class="n">Im_iph_exp</span><span class="p">,</span>
                                         <span class="n">mod_iph_calc</span><span class="p">,</span>
                                         <span class="n">phase_iph_calc</span><span class="p">,</span>
                                         <span class="n">Re_iph_calc</span><span class="p">,</span>
                                         <span class="n">Im_iph_calc</span><span class="p">,</span>
                                         <span class="n">Res_mod</span><span class="p">,</span>
                                         <span class="n">Res_phase</span><span class="p">,</span>
                                         <span class="n">Res_Re</span><span class="p">,</span>
                                         <span class="n">Res_Im</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">header</span><span class="p">,</span> <span class="n">data_array</span></div>



<div class="viewcode-block" id="save_results">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.save_results">[docs]</a>
<span class="k">def</span> <span class="nf">save_results</span><span class="p">(</span><span class="n">run</span><span class="p">,</span> <span class="n">process_id</span><span class="p">,</span> <span class="n">fit_folder</span><span class="p">,</span> <span class="n">datafilepath</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="n">hv</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">,</span>
                 <span class="n">prm_min_run</span><span class="p">,</span> <span class="n">prm_end_run</span><span class="p">,</span> <span class="n">distance_min_run</span><span class="p">,</span> <span class="n">distance_end_run</span><span class="p">,</span>
                 <span class="n">minimization_results</span><span class="p">,</span> <span class="n">header_minimization_results</span><span class="p">):</span>
    <span class="n">nb_SC</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">prm_end_run</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1"># save minimization results</span>
    <span class="c1"># filepath = fit_folder + &#39;/&#39; + name + &#39;-&#39; + suffix + &#39;-&#39; + str(process_id)+ &#39;-&#39; + str(run+1) + &#39;.&#39; + PRM_ALL_RUN_EXT</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">fit_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">process_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">run</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">PRM_ALL_RUN_EXT</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">minimization_results</span><span class="p">,</span>
               <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%+.4f</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%+.16e</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">12</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%+.16e</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">nb_SC</span><span class="p">,</span>
               <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="n">header</span><span class="o">=</span><span class="n">header_minimization_results</span><span class="p">)</span>

    <span class="c1"># save minimum</span>
    <span class="n">distance_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">distance_min_run</span><span class="p">))</span>
    <span class="c1"># filepath = fit_folder + &#39;/&#39; + name + &#39;-&#39; + suffix + &#39;-&#39; + str(process_id)+ &#39;-&#39; + str(run+1) + &#39;-d&#39; + distance_str + &#39;.&#39; + PRM_MIN_EXT</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">fit_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">process_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">run</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-d&#39;</span> <span class="o">+</span> <span class="n">distance_str</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">PRM_MIN_EXT</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">prm_min_run</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%+.16e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%+.1e</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">iph_calc_complex</span> <span class="o">=</span> <span class="n">get_Iph_calc</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">prm_min_run</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">)</span>
    <span class="n">header</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">get_results_array</span><span class="p">(</span><span class="n">hv</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">iph_exp_complex</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">iph_calc_complex</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    <span class="c1"># filepath = fit_folder + &#39;/&#39; + name + &#39;-&#39; + suffix + &#39;-&#39; + str(process_id)+ &#39;-&#39; + str(run+1) + &#39;-d&#39; + distance_str + &#39;.&#39; + DATA_MIN_EXT</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">fit_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">process_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">run</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-d&#39;</span> <span class="o">+</span> <span class="n">distance_str</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">DATA_MIN_EXT</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%+.16e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>

    <span class="n">ext</span> <span class="o">=</span> <span class="s1">&#39;pdf&#39;</span>
    <span class="c1"># filepath = fit_folder + &#39;/&#39; + name + &#39;-&#39; + suffix + &#39;-&#39; + str(process_id) + &#39;-&#39; + str(run+1) + &#39;-&#39; + &#39;min&#39; + &#39;-&#39; + &#39;d&#39; + distance_str + &#39;.&#39; + ext</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">fit_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">process_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">run</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="s1">&#39;min&#39;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span> <span class="o">+</span> <span class="n">distance_str</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">ext</span>
    <span class="n">save_pdf</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>
             <span class="n">hv</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">iph_calc_complex</span><span class="p">,</span>
             <span class="n">mask</span><span class="p">,</span> <span class="n">minimization_results</span><span class="p">)</span>

    <span class="c1"># save end</span>
    <span class="n">distance_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">distance_end_run</span><span class="p">))</span>
    <span class="c1"># filepath = fit_folder + &#39;/&#39; + name + &#39;-&#39; + suffix + &#39;-&#39; + str(process_id)+ &#39;-&#39; + str(run+1) + &#39;-d&#39; + distance_str + &#39;.&#39; + PRM_END_EXT</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">fit_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">process_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">run</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-d&#39;</span> <span class="o">+</span> <span class="n">distance_str</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">PRM_END_EXT</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">prm_end_run</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%+.16e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%+.1e</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">iph_calc_complex</span> <span class="o">=</span> <span class="n">get_Iph_calc</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">prm_end_run</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">)</span>
    <span class="n">header</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">get_results_array</span><span class="p">(</span><span class="n">hv</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">iph_exp_complex</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">iph_calc_complex</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    <span class="c1"># filepath = fit_folder + &#39;/&#39; + name + &#39;-&#39; + suffix + &#39;-&#39; + str(process_id)+ &#39;-&#39; + str(run+1) + &#39;-d&#39; + distance_str + &#39;.&#39; + DATA_END_EXT</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">fit_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">process_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">run</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-d&#39;</span> <span class="o">+</span> <span class="n">distance_str</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">DATA_END_EXT</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%+.16e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>

    <span class="n">ext</span> <span class="o">=</span> <span class="s1">&#39;pdf&#39;</span>
    <span class="c1"># filepath = fit_folder + &#39;/&#39; + name + &#39;-&#39; + suffix + &#39;-&#39; + str(process_id) + &#39;-&#39; + str(run+1) + &#39;-&#39; + &#39;End&#39; + &#39;-&#39; + &#39;d&#39; + distance_str + &#39;.&#39; + ext</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">fit_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">process_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
        <span class="n">run</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="s1">&#39;End&#39;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span> <span class="o">+</span> <span class="n">distance_str</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">ext</span>
    <span class="n">save_pdf</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>
             <span class="n">hv</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">iph_calc_complex</span><span class="p">,</span>
             <span class="n">mask</span><span class="p">,</span> <span class="n">minimization_results</span><span class="p">)</span></div>



<div class="viewcode-block" id="save_pdf">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.save_pdf">[docs]</a>
<span class="k">def</span> <span class="nf">save_pdf</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>
             <span class="n">hv</span><span class="p">,</span> <span class="n">iph_exp_complex</span><span class="p">,</span> <span class="n">iph_calc_complex</span><span class="p">,</span>
             <span class="n">mask</span><span class="p">,</span> <span class="n">all_results</span><span class="p">):</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="n">scilimits</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">scilimits</span><span class="o">=</span><span class="n">scilimits</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hv</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">[</span><span class="n">mask</span><span class="p">]),</span> <span class="o">**</span><span class="n">DATA_SAVE_STYLE</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hv</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">[</span><span class="n">mask</span><span class="p">]),</span> <span class="o">**</span><span class="n">FIT_SAVE_STYLE</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Iph vs $h\nu$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$h\nu$ /eV&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Iph /A&#39;</span><span class="p">)</span>
    <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">scilimits</span><span class="o">=</span><span class="n">scilimits</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hv</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="o">**</span><span class="n">DATA_SAVE_STYLE</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hv</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="o">**</span><span class="n">FIT_SAVE_STYLE</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta$ vs $h\nu$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$h\nu$ /eV&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta$ /$^{\circ}$&#39;</span><span class="p">)</span>
    <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">scilimits</span><span class="o">=</span><span class="n">scilimits</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hv</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">[</span><span class="n">mask</span><span class="p">]),</span> <span class="o">**</span><span class="n">DATA_SAVE_STYLE</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hv</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">[</span><span class="n">mask</span><span class="p">]),</span> <span class="o">**</span><span class="n">DATA_SAVE_STYLE</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hv</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">[</span><span class="n">mask</span><span class="p">]),</span> <span class="o">**</span><span class="n">FIT_SAVE_STYLE</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hv</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">[</span><span class="n">mask</span><span class="p">]),</span> <span class="o">**</span><span class="n">FIT_SAVE_STYLE</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Re(Iph) and Im(Iph) vs $h\nu$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$h\nu$ /eV&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Iph /A&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">scilimits</span><span class="o">=</span><span class="n">scilimits</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">iph_exp_complex</span><span class="p">),</span> <span class="o">**</span><span class="n">DATA_SAVE_STYLE</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">iph_calc_complex</span><span class="p">),</span> <span class="o">**</span><span class="n">FIT_SAVE_STYLE</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Iph vs $h\nu$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$h\nu$ /eV&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Iph /A&#39;</span><span class="p">)</span>
    <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">scilimits</span><span class="o">=</span><span class="n">scilimits</span><span class="p">)</span>
    <span class="n">mask_</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">all_results</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">mask_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">mask_</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">mask_</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">all_results</span><span class="p">[</span><span class="n">mask_</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">DISTANCE_INVALID_STYLE</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">all_results</span><span class="p">[</span><span class="n">mask_valid</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">all_results</span><span class="p">[</span><span class="n">mask_valid</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">DISTANCE_VALID_STYLE</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;log10(D) vs no fit&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;No of minimization&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;log(D)&#39;</span><span class="p">)</span>
    <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">pdf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="get_summary">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.get_summary">[docs]</a>
<span class="k">def</span> <span class="nf">get_summary</span><span class="p">(</span><span class="n">fit_folder</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    List result files for the triplets :math:`(K_i, \theta_i, Eg_i)` at the end and the minimum of each run.</span>

<span class="sd">    Compute the distance, the LCCs for the energy interval that was used for minimizing the the triplets :math:`(K_i, \theta_i, Eg_i)`.</span>

<span class="sd">    The results are saved in 4 files: .SumEnd, .SumEndEg, *.SumMin, *.SumMinEg.</span>


<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    fit_folder: string</span>
<span class="sd">        Path of the fit folder.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dirpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fit_folder</span><span class="p">)</span>
    <span class="n">listfiles</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
    <span class="n">PRM_end</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">PRM_min</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fitsettings_filepath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="n">run</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listfiles</span><span class="p">:</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="n">PRM_END_EXT</span><span class="p">:</span>
            <span class="n">run</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">PRM_end</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">dirpath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="n">PRM_MIN_EXT</span><span class="p">:</span>
            <span class="n">PRM_min</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">dirpath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="n">FIT_SETTING_EXT</span><span class="p">:</span>
            <span class="n">fitsettings_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">dirpath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>

    <span class="n">fitsettings_fobj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fitsettings_filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">fitsettings_lines</span> <span class="o">=</span> <span class="n">fitsettings_fobj</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">fitsettings_fobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">fitsettings_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fitsettings_lines</span><span class="p">:</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
        <span class="n">fitsettings_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">fit_type</span> <span class="o">=</span> <span class="n">fitsettings_dict</span><span class="p">[</span><span class="s1">&#39;Fit type&#39;</span><span class="p">]</span>
    <span class="n">hv_start</span><span class="p">,</span> <span class="n">hv_end</span> <span class="o">=</span> <span class="n">fitsettings_dict</span><span class="p">[</span><span class="s1">&#39;Energy Range (eV)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">hv_start</span><span class="p">,</span> <span class="n">hv_end</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">hv_start</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">hv_end</span><span class="p">)</span>

    <span class="n">K_min</span><span class="p">,</span> <span class="n">K_max</span> <span class="o">=</span> <span class="n">fitsettings_dict</span><span class="p">[</span><span class="s1">&#39;K min, K max&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">K_bound</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">K_min</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">K_max</span><span class="p">))</span>
    <span class="n">Eg_min</span><span class="p">,</span> <span class="n">Eg_max</span> <span class="o">=</span> <span class="n">fitsettings_dict</span><span class="p">[</span><span class="s1">&#39;Eg min, Eg max&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">Eg_bound</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">Eg_min</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">Eg_max</span><span class="p">))</span>

    <span class="n">datafilepath</span> <span class="o">=</span> <span class="n">fitsettings_dict</span><span class="p">[</span><span class="s1">&#39;Experimental Data File&#39;</span><span class="p">]</span>
    <span class="n">result_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fitsettings_dict</span><span class="p">[</span><span class="s1">&#39;Result Folder&#39;</span><span class="p">])</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">fitsettings_dict</span><span class="p">[</span><span class="s1">&#39;Suffix&#39;</span><span class="p">]</span>

    <span class="n">hv</span><span class="p">,</span> <span class="n">iph</span><span class="p">,</span> <span class="n">iphN</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">iphB</span><span class="p">,</span> <span class="n">flag_iphB</span> <span class="o">=</span> <span class="n">get_exp_data</span><span class="p">(</span><span class="n">datafilepath</span><span class="p">)</span>
    <span class="n">mask</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">hv</span> <span class="o">&gt;=</span> <span class="n">hv_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hv</span> <span class="o">&lt;=</span> <span class="n">hv_end</span><span class="p">))</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">hv</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fit_type</span> <span class="o">==</span> <span class="s1">&#39;Iph*&#39;</span><span class="p">:</span>
        <span class="n">iph_exp_comp</span> <span class="o">=</span> <span class="n">iph</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>
        <span class="n">phi_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">hv</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">hv</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">fit_type</span> <span class="o">==</span> <span class="s1">&#39;Iph&#39;</span><span class="p">:</span>
        <span class="n">iph_exp_comp</span> <span class="o">=</span> <span class="n">iphB</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">phase</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>
        <span class="n">phi_N</span> <span class="o">=</span> <span class="n">iphB</span> <span class="o">/</span> <span class="n">iph</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">iphB</span>

    <span class="n">prm_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">PRM_end</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">prm_i</span> <span class="o">=</span> <span class="n">import_prm_file</span><span class="p">(</span><span class="n">prm_filepath</span><span class="p">)</span>
    <span class="n">nb_SC</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">prm_i</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">header_end_elements</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Nb of Run&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;Valid&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;log10(D)&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;LCC Module&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;LCC Phase&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;LCC Re&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;LCC Im&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;slope Module&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;slope Phase&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;slope Re&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;slope Im&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;intercept Module&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;intercept Phase&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;intercept Re&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;intercept Im&#39;</span><span class="p">]</span>
    <span class="n">header_end</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_end_elements</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_SC</span><span class="p">):</span>
        <span class="n">header_end</span> <span class="o">=</span> <span class="n">header_end</span> <span class="o">+</span> <span class="s1">&#39;K_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
        <span class="n">header_end</span> <span class="o">=</span> <span class="n">header_end</span> <span class="o">+</span> <span class="s1">&#39;Phi_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
        <span class="n">header_end</span> <span class="o">=</span> <span class="n">header_end</span> <span class="o">+</span> <span class="s1">&#39;Eg_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>

    <span class="n">header_end_dtypes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">({</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">header_end</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="mi">128</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">_FLOAT</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header_end</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)})</span>

    <span class="n">header_end_Eg_elements</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Nb of Run&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;Valid&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;log10(D)&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;LCC Module&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;LCC Phase&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;LCC Re&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;LCC Im&#39;</span><span class="p">]</span>
    <span class="n">header_end_Eg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_end_Eg_elements</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_SC</span><span class="p">):</span>
        <span class="n">header_end_Eg</span> <span class="o">=</span> <span class="n">header_end_Eg</span> <span class="o">+</span> <span class="s1">&#39;Eg_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>

    <span class="n">header_end_Eg_dtypes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">({</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">header_end_Eg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="mi">128</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">_FLOAT</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header_end</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)})</span>

    <span class="n">col</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_end_elements</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">nb_SC</span>
    <span class="n">col_Eg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_end_Eg_elements</span><span class="p">)</span> <span class="o">+</span> <span class="n">nb_SC</span>

    <span class="n">summary_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">run</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">header_end_dtypes</span><span class="p">)</span>
    <span class="n">summary_Eg_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">run</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">header_end_Eg_dtypes</span><span class="p">)</span>
    <span class="n">summary_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">run</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">header_end_dtypes</span><span class="p">)</span>
    <span class="n">summary_Eg_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">run</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">header_end_Eg_dtypes</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">PRM_end</span><span class="p">):</span>
        <span class="n">run_i</span><span class="p">,</span> <span class="n">minimization_i</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>

        <span class="n">prm</span> <span class="o">=</span> <span class="n">import_prm_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">validate_prm</span><span class="p">(</span><span class="n">prm</span><span class="p">,</span> <span class="n">K_bound</span><span class="p">,</span> <span class="n">Eg_bound</span><span class="p">)</span>

        <span class="n">iph_calc_comp</span> <span class="o">=</span> <span class="n">get_Iph_calc</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">prm</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">)</span>
        <span class="c1"># distance = np.log10(get_distance(iph_exp_comp[mask], iph_calc_comp[mask]))</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
            <span class="n">_get_chi2</span><span class="p">(</span><span class="n">prm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">hv</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">prm</span><span class="p">,</span> <span class="n">iph_exp_comp</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">phi_N</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">weights</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>

        <span class="n">LCC_results</span> <span class="o">=</span> <span class="n">get_LCC</span><span class="p">(</span><span class="n">iph_exp_comp</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">iph_calc_comp</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>

        <span class="n">summary_end</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">run_i</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">minimization_i</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span>
                            <span class="n">distance</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">LCC_results</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">summary_Eg_end</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">run_i</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">minimization_i</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span>
                               <span class="n">distance</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">LCC_results</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prm</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="c1"># sort over the log10 (D)</span>
    <span class="n">mask_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">summary_end</span><span class="p">[</span><span class="s1">&#39;log10(D)&#39;</span><span class="p">])</span>
    <span class="n">mask_Eg_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">summary_Eg_end</span><span class="p">[</span><span class="s1">&#39;log10(D)&#39;</span><span class="p">])</span>

    <span class="c1"># filepath = os.path.abspath(result_folder + &#39;/&#39; + basename + &#39;-&#39; + suffix + &#39;.&#39; + SUMMARY_END_EXT)</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">result_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">SUMMARY_END_EXT</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">summary_end</span><span class="p">[</span><span class="n">mask_end</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%+.4f</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%+.16e</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="n">header</span><span class="o">=</span><span class="n">header_end</span><span class="p">)</span>

    <span class="c1"># filepath = os.path.abspath(result_folder + &#39;/&#39; + basename + &#39;-&#39; + suffix + &#39;.&#39; + SUMMARY_END_Eg_EXT)</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">result_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">SUMMARY_END_Eg_EXT</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">summary_Eg_end</span><span class="p">[</span><span class="n">mask_Eg_end</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%+.4f</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%+.16e</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">col_Eg</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span>
               <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header_end_Eg</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">PRM_min</span><span class="p">):</span>
        <span class="n">run_i</span><span class="p">,</span> <span class="n">minimization_i</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>

        <span class="n">prm</span> <span class="o">=</span> <span class="n">import_prm_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">validate_prm</span><span class="p">(</span><span class="n">prm</span><span class="p">,</span> <span class="n">K_bound</span><span class="p">,</span> <span class="n">Eg_bound</span><span class="p">)</span>

        <span class="n">iph_calc_comp</span> <span class="o">=</span> <span class="n">get_Iph_calc</span><span class="p">(</span><span class="n">hv</span><span class="p">,</span> <span class="n">prm</span><span class="p">,</span> <span class="n">phi_N</span><span class="p">)</span>
        <span class="c1"># distance = np.log10(get_distance(iph_exp_comp[mask],iph_calc_comp[mask]))</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
            <span class="n">_get_chi2</span><span class="p">(</span><span class="n">prm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">hv</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">prm</span><span class="p">,</span> <span class="n">iph_exp_comp</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">phi_N</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">weights</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>

        <span class="n">LCC_results</span> <span class="o">=</span> <span class="n">get_LCC</span><span class="p">(</span><span class="n">iph_exp_comp</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">iph_calc_comp</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>

        <span class="n">summary_min</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">run_i</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">minimization_i</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span>
                            <span class="n">distance</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">LCC_results</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prm</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">summary_Eg_min</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">run_i</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">minimization_i</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span>
                               <span class="n">distance</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">LCC_results</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prm</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

    <span class="c1"># sort over the log10 (D)</span>
    <span class="n">mask_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">summary_min</span><span class="p">[</span><span class="s1">&#39;log10(D)&#39;</span><span class="p">])</span>
    <span class="n">mask_Eg_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">summary_Eg_min</span><span class="p">[</span><span class="s1">&#39;log10(D)&#39;</span><span class="p">])</span>

    <span class="c1"># filepath = os.path.abspath(result_folder + &#39;/&#39; + basename + &#39;-&#39; + suffix + &#39;.&#39; + SUMMARY_MIN_EXT)</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">result_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">SUMMARY_MIN_EXT</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">summary_min</span><span class="p">[</span><span class="n">mask_min</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%+.4f</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%+.16e</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
               <span class="n">header</span><span class="o">=</span><span class="n">header_end</span><span class="p">)</span>

    <span class="c1"># filepath = os.path.abspath(result_folder + &#39;/&#39; + basename + &#39;-&#39; + suffix + &#39;.&#39; + SUMMARY_MIN_Eg_EXT)</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">result_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">SUMMARY_MIN_Eg_EXT</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">summary_Eg_min</span><span class="p">[</span><span class="n">mask_Eg_min</span><span class="p">],</span> <span class="n">fmt</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%+.4f</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%+.16e</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">col_Eg</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span>
               <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header_end_Eg</span><span class="p">)</span></div>



<div class="viewcode-block" id="plot_summary">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.plot_summary">[docs]</a>
<span class="k">def</span> <span class="nf">plot_summary</span><span class="p">(</span><span class="n">fit_folder</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Plot the result files that were created by the :func:`get_summary`</span>
<span class="sd">    for he triplets :math:`(K_i, \theta_i, Eg_i)` at the end and the minimum of each run.</span>

<span class="sd">    The results are saved in 2 files: -0-End.pdf, -0-Min.pdf.</span>


<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>
<span class="sd">    fit_folder: string</span>
<span class="sd">        Path of the fit folder.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dirpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fit_folder</span><span class="p">)</span>
    <span class="n">listfiles</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>

    <span class="n">summary_end_filepath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">summary_min_filepath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">fitsettings_filepath</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">listfiles</span><span class="p">:</span>
        <span class="n">cuts</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">cuts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="n">SUMMARY_END_EXT</span><span class="p">:</span>
            <span class="n">summary_end_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">dirpath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="n">SUMMARY_MIN_EXT</span><span class="p">:</span>
            <span class="n">summary_min_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">dirpath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="n">FIT_SETTING_EXT</span><span class="p">:</span>
            <span class="n">fitsettings_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">dirpath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>

    <span class="c1"># read the number of SC contributions</span>
    <span class="n">fitsettings_fobj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fitsettings_filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">fitsettings_lines</span> <span class="o">=</span> <span class="n">fitsettings_fobj</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">fitsettings_fobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">fitsettings_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fitsettings_lines</span><span class="p">:</span>
        <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
        <span class="n">fitsettings_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">nb_SC</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fitsettings_dict</span><span class="p">[</span><span class="s1">&#39;No of SC Contributions&#39;</span><span class="p">])</span>
    <span class="n">result_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fitsettings_dict</span><span class="p">[</span><span class="s1">&#39;Result Folder&#39;</span><span class="p">])</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="n">fitsettings_dict</span><span class="p">[</span><span class="s1">&#39;Suffix&#39;</span><span class="p">]</span>

    <span class="c1"># read header</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">summary_end_filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">header_end</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;# &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">Eg_start_col</span> <span class="o">=</span> <span class="n">header_end</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Eg_1&#39;</span><span class="p">)</span>
    <span class="n">K_start_col</span> <span class="o">=</span> <span class="n">header_end</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;K_1&#39;</span><span class="p">)</span>
    <span class="n">Phi_start_col</span> <span class="o">=</span> <span class="n">header_end</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Phi_1&#39;</span><span class="p">)</span>

    <span class="n">col</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">header_end</span><span class="p">)</span>

    <span class="n">summary_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">summary_end_filepath</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                             <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                             <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">unpack</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">({</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">header_end</span><span class="p">,</span>
                                             <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="mi">128</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">_FLOAT</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)}),</span>
                             <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">summary_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">summary_min_filepath</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
                             <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span>
                             <span class="n">skiprows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                             <span class="n">unpack</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">({</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">header_end</span><span class="p">,</span>
                                             <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="mi">128</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">_FLOAT</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)}),</span>
                             <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># filepath = os.path.abspath(result_folder + &#39;/&#39; + basename + &#39;-&#39; + suffix + &#39;-&#39; + &#39;0&#39; + &#39;-&#39; + &#39;End&#39; + &#39;.&#39; + &#39;pdf&#39;)</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">result_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="s1">&#39;End&#39;</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
    <span class="n">pdf_end</span> <span class="o">=</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="c1"># filepath = os.path.abspath(result_folder + &#39;/&#39; + basename + &#39;-&#39; + suffix + &#39;-&#39; + &#39;0&#39; + &#39;-&#39; + &#39;Min&#39; + &#39;.&#39; + &#39;pdf&#39;)</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">result_folder</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="s1">&#39;Min&#39;</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
    <span class="n">pdf_min</span> <span class="o">=</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="s1">&#39;C4&#39;</span><span class="p">,</span> <span class="s1">&#39;C5&#39;</span><span class="p">,</span> <span class="s1">&#39;C6&#39;</span><span class="p">,</span> <span class="s1">&#39;C7&#39;</span><span class="p">,</span> <span class="s1">&#39;C8&#39;</span><span class="p">,</span> <span class="s1">&#39;C9&#39;</span><span class="p">]</span>
    <span class="c1"># Eg vs No Runs for END prm values</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$Eg_i$ vs No Run&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;No Run&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Eg_i$ /eV&#39;</span><span class="p">)</span>
    <span class="n">Egi</span> <span class="o">=</span> <span class="n">summary_end</span><span class="p">[</span><span class="n">header_end</span><span class="p">[</span><span class="n">Eg_start_col</span><span class="p">:</span><span class="n">Eg_start_col</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">nb_SC</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">summary_end</span><span class="o">.</span><span class="n">size</span>
    <span class="n">no_run</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_SC</span><span class="p">):</span>
        <span class="n">indc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">no_run</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">Egi</span><span class="p">[</span><span class="s1">&#39;Eg_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">indc</span><span class="p">],</span> <span class="o">**</span><span class="n">DATA_SUMMARY_STYLE</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">no_run</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">summary_end</span><span class="p">[</span><span class="s1">&#39;Nb of Run&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">summary_end</span><span class="p">[</span><span class="s1">&#39;Nb of Run&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">summary_end</span><span class="p">[</span><span class="s1">&#39;Nb of Run&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">pdf_end</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">summary_end</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distribution of $Eg_i$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Eg_i$ /eV&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f runs (</span><span class="si">{0:d}</span><span class="s1"> runs)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">no_run</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_run</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">no_run</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_SC</span><span class="p">):</span>
            <span class="n">indc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Egi</span><span class="p">[</span><span class="s1">&#39;Eg_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">indc</span><span class="p">])</span>
        <span class="n">pdf_end</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">summary_end</span><span class="p">[</span><span class="n">header_end</span><span class="p">[</span><span class="n">K_start_col</span><span class="p">:</span><span class="n">K_start_col</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">nb_SC</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">_FLOAT</span><span class="p">)</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">summary_end</span><span class="p">[</span><span class="n">header_end</span><span class="p">[</span><span class="n">Phi_start_col</span><span class="p">:</span><span class="n">Phi_start_col</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">nb_SC</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">_FLOAT</span><span class="p">)</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$K_i$ vs $\theta _i$&#39;</span><span class="p">)</span>
    <span class="c1"># ax.scatter(phase, K, c=phase, s = 100)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">scatter_logpolar</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">pdf_end</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="n">pdf_end</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Eg vs No Runs for MIN prm values</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$Eg_i$ vs No Run&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;No Run&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Eg_i$ /eV&#39;</span><span class="p">)</span>
    <span class="n">Egi</span> <span class="o">=</span> <span class="n">summary_min</span><span class="p">[</span><span class="n">header_end</span><span class="p">[</span><span class="n">Eg_start_col</span><span class="p">:</span><span class="n">Eg_start_col</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">nb_SC</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">summary_min</span><span class="o">.</span><span class="n">size</span>
    <span class="n">no_run</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_SC</span><span class="p">):</span>
        <span class="n">indc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">no_run</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">Egi</span><span class="p">[</span><span class="s1">&#39;Eg_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">indc</span><span class="p">],</span> <span class="o">**</span><span class="n">DATA_SUMMARY_STYLE</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">no_run</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">summary_end</span><span class="p">[</span><span class="s1">&#39;Nb of Run&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">summary_min</span><span class="p">[</span><span class="s1">&#39;Nb of Run&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">summary_min</span><span class="p">[</span><span class="s1">&#39;Nb of Run&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">pdf_min</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">summary_min</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distribution of $Eg_i$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Eg_i$ /eV&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f runs (</span><span class="si">{0:d}</span><span class="s1"> runs)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">no_run</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">no_run</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span> <span class="o">/</span> <span class="n">no_run</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_SC</span><span class="p">):</span>
            <span class="n">indc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Egi</span><span class="p">[</span><span class="s1">&#39;Eg_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">indc</span><span class="p">])</span>
        <span class="n">pdf_min</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$K_i$ vs $\theta _i$&#39;</span><span class="p">)</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">summary_min</span><span class="p">[</span><span class="n">header_end</span><span class="p">[</span><span class="n">K_start_col</span><span class="p">:</span><span class="n">K_start_col</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">nb_SC</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">_FLOAT</span><span class="p">)</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">summary_min</span><span class="p">[</span><span class="n">header_end</span><span class="p">[</span><span class="n">Phi_start_col</span><span class="p">:</span><span class="n">Phi_start_col</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">nb_SC</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">_FLOAT</span><span class="p">)</span>
    <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
    <span class="c1"># ax.scatter(phase, K, c=phase, s = 100)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">scatter_logpolar</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">pdf_min</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="n">pdf_min</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="scatter_logpolar">
<a class="viewcode-back" href="../../api/codedoc.html#pypec.iph_functions.scatter_logpolar">[docs]</a>
<span class="k">def</span> <span class="nf">scatter_logpolar</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">r_</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">bullseye</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">min10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">r_</span><span class="p">)))</span>
    <span class="n">max10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">r_</span><span class="p">)))</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">r_</span><span class="p">)</span> <span class="o">-</span> <span class="n">min10</span> <span class="o">+</span> <span class="n">bullseye</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min10</span><span class="p">,</span> <span class="n">max10</span><span class="p">,</span> <span class="n">ticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_rticks</span><span class="p">(</span><span class="n">l</span> <span class="o">-</span> <span class="n">min10</span> <span class="o">+</span> <span class="n">bullseye</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;$10^{&quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;}$&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_rlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max10</span> <span class="o">-</span> <span class="n">min10</span> <span class="o">+</span> <span class="n">bullseye</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TEST 1&#39;</span><span class="p">)</span>

    <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;C:/Users/mskocic/Desktop/Zy2-S8/&#39;</span>
    <span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;2015_12_18-093519-Zy2-S8-777-RRR-2.13eV_5.64eV/&#39;</span>
    <span class="n">get_summary</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="n">folder</span><span class="p">)</span>
    <span class="n">plot_summary</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="n">folder</span><span class="p">)</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pypec 0.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pypec.iph_functions</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2023 Milan Skocic.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>